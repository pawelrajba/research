#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// s is a string of 128 bit ie. 16 byte
// encrypt applies the state transition function of AKARI-1 with m=64 onto the string and transfers the result back to s
void encrypt(char* s){
    unsigned long long int x0,x1;
    unsigned __int128 z;

    x0 = *((unsigned long long int*)s);
    x1 = *((unsigned long long int*)(s+8));

    x0 = x0 + ((x0*x0)| 0x5);
    x1 = x1 + ((x1*x1)| 0xd);

    z = x0;
    for (int r=0;r<64;r++)
    {
        z = (z >> 1) + (z << 1) + z + x1;
    }
    *((unsigned long long int*)s) = z;
}

void encrypt_simple(char* s){
    unsigned long long int x0,x1;

    x0 = *((unsigned long long int*)s);
    x1 = *((unsigned long long int*)(s+8));

    x0 = x0 + ((x0*x0)| 0x5);

    *((unsigned long long int*)s) = x0;
    *((unsigned long long int*)(s+8)) = x1;
}

int main(int argc,char *argv[]){
    int i;
    char str[25][17] = {
        {215,71,170,132,168,139,118,130,2,251,37,182,144,76,167,121},
        {205,195,3,28,112,1,229,253,181,228,137,137,91,135,243,150},
        {140,60,152,227,122,62,201,244,207,94,42,203,90,74,255,237},
        {179,173,101,23,210,38,56,191,179,114,7,81,253,48,56,150},
        {229,172,130,39,85,245,35,4,197,50,38,153,112,99,215,242},
        {93,78,133,182,239,66,138,146,222,25,25,88,31,115,66,249},
        {189,223,69,87,69,91,223,34,68,215,191,170,184,246,84,125},
        {137,51,177,180,51,95,17,126,223,109,132,106,149,231,173,86},
        {71,75,213,45,237,125,39,89,157,133,49,200,213,11,173,200},
        {154,88,88,138,122,95,247,41,50,168,145,79,126,19,86,243},
        {236,35,202,156,130,209,169,127,61,61,109,51,37,11,177,130},
        {216,207,40,111,220,204,61,191,59,49,238,23,107,5,130,58},
        {45,149,42,41,214,199,24,148,18,253,150,117,31,130,28,83},
        {207,62,194,113,241,203,96,78,230,197,218,197,45,163,4,155},
        {219,38,221,128,236,117,150,197,48,80,75,10,67,30,184,110},
        {45,224,215,214,61,140,151,219,210,65,21,44,123,134,2,39},
        {73,238,82,10,7,109,126,75,218,52,137,96,23,171,177,171},
        {246,59,111,240,133,160,242,71,114,173,81,163,31,95,224,80},
        {243,179,252,4,51,98,47,4,51,179,53,180,177,5,239,167},
        {119,184,41,244,37,75,184,249,21,123,3,15,155,107,123,71},
        {56,71,254,90,242,246,84,200,63,28,200,197,86,186,169,115},
        {141,64,98,112,232,139,255,44,35,129,126,214,143,125,157,46},
        {139,7,138,58,231,78,140,250,178,33,99,138,53,133,2,73},
        {181,139,93,94,180,213,124,107,168,224,228,254,244,248,153,68},
        {201,67,75,102,48,226,128,42,157,54,43,102,182,214,109,208}
    };

    FILE *fp;

    for (int k=0;k<25;k++)
    {
        char filename[14];
        sprintf(filename, "out\\akari.%03d", k+1);

        fp = fopen(filename, "a+");
        for (int j=0;j<125;j++)
        {
            int c4 = j%10;
            int c3 = (j/10)%10;
            int c2 = (j/100)%10;
            int c1 = (j/1000)%10;

            str[k][12] = c1;
            str[k][13] = c2;
            str[k][14] = c3;
            str[k][15] = c4;
            encrypt_simple(str[k]);

            for(i=0;i<16;i++)
            {
                fprintf(fp, "%02x ",(*(str[k]+i))&0xff);
            }
            fprintf(fp, "\n");
        }
        fclose(fp);
    }
}
